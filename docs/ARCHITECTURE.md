# ClStock アーキテクチャ概要

## 1. 概要

ClStockは、AIによる株価予測と投資推奨を行うための統合システムです。REST API、CLI、CUIを通じて、推奨銘柄ランキング、売買タイミング、目標価格などを提供します。バックエンドでは、複数の機械学習モデル、データ取得モジュール、非同期処理基盤が連携して動作します。

## 2. 主要コンポーネント

システムの主要なディレクトリと、その役割は以下の通りです。

- **/api**: FastAPIを利用したAPIエンドポイントの定義。外部へのデータ提供を担当します。
- **/app**: メインアプリケーションのロジック。FastAPIのアプリケーションインスタンスや、Webダッシュボードの定義が含まれます。
- **/config**: 設定ファイル群。`settings.py`でプロジェクト全体の設定を一元管理し、環境変数による上書きも可能です。
- **/data**: データ取得・処理モジュール。`StockDataProvider`が株価データの取得とキャッシュを担当します。
- **/models**: 機械学習モデルの実装。予測器のインターフェース、各種モデル（アンサンブル、時系列解析など）、学習パイプラインが含まれます。
- **/systems**: システム全体の管理機能。プロセスマネージャーやモニタリング機能などが含まれます。
- **/trading**: 取引戦略やポートフォリオ管理のロジック。バックテストエンジンもここに配置されます。
- **/utils**: プロジェクト全体で利用される共通のユーティリティ関数群（ロガー設定など）。
- **/clstock_cli.py**: プロジェクト全体の操作を行うためのコマンドラインインターフェース（CLI）のエントリーポイント。

## 3. データフロー

1.  **データ取得**: `clstock_cli.py` やAPIリクエストを起点に、`data.StockDataProvider` が外部（例: yfinance）から株価データを取得します。
2.  **特徴量生成**: 取得した生データから、`models`内の各予測器が必要とする特徴量（テクニカル指標など）を計算します。
3.  **予測実行**: `models`内の機械学習モデル（`MLStockPredictor`など）が、特徴量を入力として株価の将来価格や推奨度スコアを予測します。
4.  **戦略決定**: `trading`モジュールが、モデルの予測結果とリスク管理ロジックに基づき、具体的な投資戦略（推奨アクション、目標価格など）を生成します。
5.  **結果提供**:
    - **API**: `api.endpoints`を通じて、予測結果や推奨情報がJSON形式で外部に提供されます。
    - **CLI/CUI**: `clstock_cli.py`や`investment_advisor_cui.py`が、整形された結果をコンソールに表示します。
    - **Dashboard**: `app.personal_dashboard.py`が、Webブラウザ上でポートフォリオや予測結果を可視化します。

## 4. 技術スタック

- **Webフレームワーク**: FastAPI, Uvicorn
- **コマンドライン**: Click
- **データ処理**: pandas, NumPy
- **機械学習**: scikit-learn, PyTorch, LightGBM, XGBoost
- **テスト**: pytest
- **その他**: SHAP (モデル解釈性), Tenacity (リトライ処理)
