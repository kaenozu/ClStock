# Issue: 擬似的な「精度87%」スタックを実証可能なシステムへ入れ替える

## 背景
- アプリは「精度87%」モデルを前提に売買推奨を提示しているが、実装はヒューリスティックとモックで構成されており統計的根拠がない。
- バックテストおよびリスク管理モジュールも実資金運用を仮定した設計になっておらず、生成される指標が実際の損益と乖離している。

## 問題点
- `models/precision/precision_87_system.py:194` ほかで RSI/SMA ヒューリスティックを固定重みで合成し、`precision_87_system.py:331` や `precision_87_system.py:342` で精度を 87〜92% に上書き、`precision_87_system.py:391` でモックにフォールバックするため精度指標が虚偽となっている。
- バックテストは `trading/backtest/runner.py:254` で 30% を乱数で「precision 87」扱いし、`trading/backtest/runner.py:256` で固定 5% リターン、`trading/backtest/runner.py:258` で初期資本基準のポジションサイズ、`trading/backtest/runner.py:323` 以降でクローズせずに取引履歴のみ記録するため損益・勝率が実際と一致しない。
- `trading/portfolio_manager.py:148` では買付時に `current_cash` をマイナスまで消費でき、`trading/risk_manager.py:83` と `trading/risk_manager.py:129` は資本を固定値として扱うためリスク上限が発動しない。
- `tests/test_backtesting.py:24` 以降のテストは帳簿操作を確認するだけで、戦略がベンチマークを上回るか資金制約を守るかを検証していない。

## 提案する対応
1. Precision87 系のヒューリスティックを廃止し、交差検証で検証済みのモデル群へ置換。精度・信頼度の実測値とチューニング過程をログに残し、モックへのフォールバックは即時失敗にする。
2. バックテスターを再設計し、実シグナルでエントリー/クローズを管理、キャッシュ・コスト・税を差し引いた正味損益とベンチマーク比較を出力する。乱数や固定値による精度判定を撤廃する。
3. `PortfolioManager` と `RiskManager` を資金残高ベースに改修し、資金不足なら約定を拒否、取引ごとに資本を更新し、セクター・ポジション上限を実エクスポージャーで強制する。
4. 既知の価格系列に対する回帰テストを追加し、正味損益・最大ドローダウン・リスク制限をアサートして擬似的な指標が混入しないようにする。

## 期待する成果
- モデル精度とバックテスト指標に統計的正当性が生まれ、推奨売買の信頼性をユーザーに提示できる。
- 資金制約とリスク制限が動作することで、実資金運用に近いシミュレーションが可能になる。
- 回帰テストにより将来の改修で擬似的な実装が再び紛れ込むリスクを抑制できる。

